{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>Post Detail -- Wayfarer</title>
{% endblock %}



{% block content %}

<div class="ui grid" style="padding: 50px;">
    <div class="ui container" style="background-color: var(--secondary); padding: 20px; border-radius: 3px;">
        <div class="ui items" style="background-color: white; padding: 20px; border-radius: 3px;">
            <div class="ui item">
                <div class="content">
                    <div class="header" style="text-transform:uppercase">{{ post.city.name }}</div>
                    <h2>{{ post.title }}</h2>
                    <h5>Posted: {{ post.posted_date | timesince}} ago</h5>

                    <!-- TODO link author name to their profile view!!!! -->
                    <h4 style="text-transform:uppercase">author: <a href="{% url 'profile' post.profile.user.username %}">{{ post.profile.user.username }}</a></h4>

                        <div class="ten wide column">

                            {% if user.is_authenticated %}
                            <button class="ui inverted tiny button" style="background-color: var(--tertiary);" id="edit-post">EDIT</button>
                            <a class="ui inverted tiny button" href="/posts/delete/{{ post.id }}/{{ post.city.name }}" style="background-color: grey;" id="delete">DELETE</a>
                            {% endif %}

                            <script>
                                $(function(){
                                    $("#edit-post").click(function(){
                                        $(".edit-post-class").modal('show');
                                    });
                                    $(".edit-post-class").modal({
                                        closable: true
                                    });
                                });
                            </script>
<!------------ ADD EDIT POST MODAL  ------------>
                            <div class="ui modal edit-post-class" style="padding: 10px;">
                                <h2 class="ui modal-header">EDIT POST</h2>
                                <div class="ui modal-body">
                                    <form class="ui small form" action="/posts/edit/{{city.name}}" method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="content">
                                            <div class="field">
                                                <label>Title</label>
                                                <input type="text" name="title" value="{{ post.title }}">
                                            </div>
                                            <div class="field">
                                                <label>Content</label>
                                                <textarea id="content" name="content" rows="8" column="2000" style="resize: none" value="{{ post.content }}">{{ post.content }}</textarea>
                                            </div>
                                            <div class="field">
                                                <label>Image</label>
                                                <input id='id_image' type='file' name='image' accept='image/*'>          
                                            </div>
                                        </div>
                                            <input class='ui small inverted button' type="submit" value="UPDATE" style="background-color: var(--tertiary); margin-top: 10px;">
                                    </form>
                                </div>
                            </div>
                            
<!------------------------ Show posts  ----------------------->
                        
                        </div>
                </div>
                <div class="ui medium image">
                    <img src="{{MEDIA_URL}}{{ post.image }}">
                </div>
            </div>
            <div class="row">
                <div class="six wide column">
                    <div class="content">
                        <p style="min-width: 100%;">{{ post.content }}</p>
                    </div>
                </div>
            </div>
            <hr>

            <h3>Comments</h3>

            <div class="ui list">

                {% for comment in post.comment_set.all %}

                    <div class="item">
                        <img class="ui avatar image" src="{{ MEDIA_URL }}static/default.jpg">
                        <div class="content">
                            <a class="header">{{post.profile.name}}</a>
                            <div class="description">{{comment.body}}</div>
                        </div>
                    </div>

                {% endfor %}

            </div>



        </div> 
    </div>
</div>



{% endblock %}